parameters:
  PipelineType: "not set"
  # sdkVersion: 18362
  codeSignInlineOperation: |
        [
          {
              "KeyCode" : "CP-230012",
              "OperationCode" : "SigntoolSign",
              "Parameters" : {
                  "OpusName" : "Microsoft",
                  "OpusInfo" : "http://www.microsoft.com",
                  "FileDigest" : "/fd \"SHA256\"",
                  "PageHash" : "/NPH",
                  "TimeStamp" : "/tr \"http://rfc3161.gtm.corp.microsoft.com/TSS/HttpTspServer\" /td sha256"
              },
              "ToolName" : "sign",
              "ToolVersion" : "1.0"
          },
          {
              "KeyCode" : "CP-230012",
              "OperationCode" : "SigntoolVerify",
              "Parameters" : {},
              "ToolName" : "sign",
              "ToolVersion" : "1.0"
          }
        ]

steps:
# Download nuget.exe
- task: BatchScript@1
  displayName: Run download-nuget.cmd
  inputs:
    filename: build\nuget\download-nuget.cmd
# Download binaries from previous stage
- task: DownloadPipelineArtifact@2
  inputs:
    artifactName: 'build_output'
    targetPath: $(Build.SourcesDirectory)
- script: |
    cd $(Build.SourcesDirectory)
    dir
  displayName: Print root directory

# Build nuget package
- task: BatchScript@1
  displayName: build-nupkg
  inputs:
    filename: build/nuget/build-nupkg.cmd
    arguments: $(packageSuffix)
# Copy nuget package to artifact staging directory
- task: CopyFiles@2
  displayName: 'Copy Nupkg to: $(Build.ArtifactStagingDirectory)'
  inputs:
    SourceFolder: bin
    Contents: >-
      *.nupkg
    TargetFolder: $(Build.ArtifactStagingDirectory)
# Publish nuget package artifact
- task: PublishBuildArtifacts@1
  displayName: 'Publish Artifact: nupkg'
  inputs:
    ArtifactName: 'nupkg'
    PathtoPublish: '$(Build.ArtifactStagingDirectory)'